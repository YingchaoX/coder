# 00. 文档范围与定位

## 1. 产品一句话定义
Coder 是一个本地终端编码代理（单二进制 REPL），通过大模型 + 本地工具在工作区内完成阅读、修改、执行与任务分解。

## 2. 本套文档回答的问题
- 当前实现的真实能力边界是什么。
- 用户输入后，系统的实际执行路径是什么。
- 各能力的约束、失败条件和可预期反馈是什么。

## 3. 边界定义（以代码为准）
- 运行形态：终端 REPL（`cmd/agent/main.go` + `internal/repl`）。
- 模型协议：OpenAI 兼容 Chat Completions（流式优先，兼容回退）。
- 文件边界：文件工具统一通过 `security.Workspace.Resolve` 做工作区约束。
- 命令执行：由 `bash` 工具执行 `/bin/sh -lc`，受超时和输出截断限制。
- 持久化：
  - SQLite：会话元数据、消息、todo、权限日志表结构。
  - 会话快照文件：`.coder/sessions/<session_id>.json`。

## 4. 术语
- 回合（Turn）：一次用户输入到助手完成输出。
- 工具调用（Tool Call）：模型返回 function call 后由本地执行。
- 审批（Approval）：命中策略 `ask` 或工具风险检查后的放行/拒绝流程。
- 复杂任务：由启发式函数 `isComplexTask` 判定（长度/关键词/分隔符/词数）。

## 5. 需求基线对应代码
- 启动链路：`cmd/agent/main.go`、`internal/bootstrap/bootstrap.go`
- 编排链路：`internal/orchestrator/*.go`
- 工具实现：`internal/tools/*.go`
- 配置与权限：`internal/config/config.go`、`internal/permission/policy.go`
