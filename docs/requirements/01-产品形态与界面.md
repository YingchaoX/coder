# 01. 产品形态与界面

## 1. 启动形态
用户通过命令直接启动二进制。

配置文件发现顺序：
1. 当前路径：`./.coder/config.json`
2. 家目录：`~/.coder/config.json`（仅在当前路径不存在时回退）
3. 若两者都不存在，使用内置默认配置

启动后进入全屏 TUI，包含：
- 主区：单面板（统一展示对话、工具输出与运行日志）。
- 输入区：多行输入框，回车发送，`Shift+Enter` 换行。
- 输入区下方：仅保留一行合并信息（快捷键/模式/状态等），不拆分多行提示；该行必须显示当前工作路径（cwd）。
- 顶部：不保留独立状态条（不展示额外顶栏状态信息）。
- 侧边栏：固定常显且内容固定为 5 个模块：`Context`、`Model`、`Todos`、`Tools`、`Skills`；不提供折叠，不展示其它模块。

## 2. 用户可见交互
- `Enter`：发送当前输入。
- `Tab`：按固定顺序轮转模式：`plan -> default -> auto-edit -> yolo -> ...`；切换后立即更新明显模式标签。
- `Esc`：将 UI 状态标记为“中断流式显示”（见限制说明）。
- `Ctrl+C`：退出程序。

## 3. 输出呈现
- 助手文本支持流式追加显示。
- 模型 `thinking` 结果支持折叠/展开查看（可默认折叠）。
- 工具开始时会记录工具名与简洁摘要。
- 工具完成时默认展示结构化摘要，并支持展开查看详细参数与完整输出。
- `write`/`patch` 返回 diff 时，主区默认使用左右并排对比视图展示，并保留基础 `+`/`-`/`@@` 高亮。

## 4. 面板行为
- 单面板按时间顺序展示：用户消息、助手结果、工具摘要、日志文本。
- 主聊天面板支持纵向滚动，可回看历史消息。
- `write`/`patch` 返回 diff 时，在同一时间线中以内联块方式展示“左右并排对比”结果。
- 文件访问轨迹作为消息内容的一部分展示，不再拆分独立 `Files` 面板。

## 5. 用户侧预期
- 这是一个“对话驱动 + 工具执行”的终端代理，而不是 IDE。
- 不需要 VSCode 插件；核心工作流在终端内完成。
- 当前主交互入口是自然语言输入、`!` 特殊命令（shell）和 `/` 特殊命令（首发：`/help` `/model` `/permissions` `/new` `/resume` `/compact` `/diff` `/review` `/undo`）。

## 6. 模式边界（用户可感知）
- `plan`：以任务拆解、方案设计、风险分析为主；默认不执行写入类工具（`write`/`patch`）与副作用命令。
- `default`：均衡模式；允许读取、分析、少量执行，涉及写入/高风险操作时按权限策略处理。
- `auto-edit`：以改动交付为主；在需求明确时可主动调用读写工具并触发自动验证与修复重试。
- `yolo`：高自治执行模式；高风险 `bash` 也默认放行执行（不再拦截 `ask` / `deny` / 硬阻断结果）。
- 四种模式都遵守工作区文件路径边界；仅 `yolo` 的 `bash` 路径例外放宽风控拦截。

## 7. 视觉与实现约束（极简）
- 视觉风格固定为单一 `OpenCode Dark`，不提供多主题切换。
- 字体使用终端默认等宽字体，不额外引入字体配置。
- UI 样式保持极简：少颜色、少装饰、少自定义样式。
- 组件实现优先复用 `charmbracelet/bubbletea` 与 `bubbles` 现有能力，尽量减少样式代码与自绘逻辑。
