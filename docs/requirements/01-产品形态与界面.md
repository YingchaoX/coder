# 01. 产品形态与界面

## 1. 启动形态
- 用户运行二进制进入 REPL：`./coder [-config ...] [-cwd ...] [-lang ...]`。
- REPL 为双行提示符：
  - 第一行：`context: <tokens> tokens · model: <model>`
  - 第二行：`[<mode>] <cwd> > `

## 2. 输入行为
### 2.1 TTY 输入
- Enter：发送当前输入。
- 多行粘贴（Bracketed Paste）：显示 `[copy N lines]`，再按 Enter 发送整段。
- Ctrl+D：忽略，不作为发送键。
- Ctrl+C：中断输入循环并退出程序。
- Esc（输入编辑态）：清空当前输入框，不提交。
- Esc（运行态）：取消当前自动化流程（流式输出、tool-call、审批等待、自动重试链路），返回可输入状态并打印统一提示：
  - `Cancelled by ESC`
  - `Stopped model stream and tool execution; todo state remains unchanged unless a tool had already completed.`
- 方向键历史：当前版本未实现可视化历史回放（仅内部记录 history，不提供 ↑/↓ 回显编辑）。

### 2.2 非 TTY 输入
- 从 stdin 读取到 EOF，作为一次消息提交。

## 3. 输出呈现
输出块按时间顺序写入 stdout，典型块类型：
- `[ANSWER]`：助手正文。
- `[THINK]`：模型 reasoning。
- `[TOOL]`：工具开始/结果/错误。
- `[COMMAND]`：`!` 命令模式结果。

## 4. 可用交互入口
- 普通输入：进入模型-工具循环。
- `!<shell>`：命令模式（直接执行 `bash` 工具）。
- `/` 内建命令：
  - `/help`
  - `/model <name>`
  - `/permissions [preset]`
  - `/mode <name>`、`/plan`、`/default`、`/auto-edit`、`/yolo`
  - `/tools`、`/skills`、`/todos`
  - `/new`、`/resume [session-id]`、`/sessions`
  - `/compact`、`/diff`、`/undo`

### 4.1 `/help` 展示约束
- `/help` 输出中的命令列表需按“每行一个命令”展示，避免全部命令挤在同一行。

## 5. 模式（用户可见）
- 支持值：`plan`、`default`、`auto-edit`、`yolo`。
- 当前实现中，模式主要用于提示符显示与会话状态表达；工具执行策略仍主要由 Agent 工具开关与 Permission Policy 决定。

## 6. 颜色约定（终端 ANSI）
- context 行：dim gray
- 提示符：green
- `[ANSWER]`：cyan 标题
- `[THINK]`：gray
- 工具开始：yellow
- 工具成功摘要：green + gray
- 工具失败：red
- diff：`+` green、`-` red、`@@` cyan、头部 yellow
